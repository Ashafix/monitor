<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>
    <link rel="stylesheet" href="style.css">
    <script src="plotly-latest.min.js"></script>
    <script>


      function createRequest() {
        var result = null;
        if (window.XMLHttpRequest) {
          // FireFox, Safari, etc.
          result = new XMLHttpRequest();
          if (typeof result.overrideMimeType != 'undefined') {
            result.overrideMimeType('text/xml'); // Or anything else
          }
        } else if (window.ActiveXObject) {
          // MSIE
          result = new ActiveXObject("Microsoft.XMLHTTP");
        } 
        return result;
      }
    function update_cpu() {
      var req = createRequest(); // defined above
      // Create the callback:
      req.onreadystatechange = function() {
        if (req.readyState != 4) return; // Not there yet
        // Request successful, read the response
        var cpu_avg = document.getElementById('cpu_avg');
        var cpus = document.getElementById('cpus');
        var obj = JSON.parse(req.responseText);
        var layout = {
          showlegend: false,
          xaxis: {autorange: true},
          yaxis: {range: [30, 100]}
        };
        Plotly.newPlot(cpu_avg, obj.averages, layout);
        Plotly.newPlot(cpus, obj.data, layout);
        //console.log(obj.averages)
      }
      var url = "http://192.168.178.37:8004/cpu_temperature";
      req.open("GET", url, true);
      req.send();
    }
    function realtime_cpu() {
      var req = createRequest(); // defined above
      // Create the callback:
      req.onreadystatechange = function() {
        if (req.readyState != 4) return; // Not there yet
        // Request successful, read the response
        var cpu_rt = document.getElementById('cpu_realtime');
        var obj = JSON.parse(req.responseText);
        var layout = {type: 'bar'};
        var values = [];
        var x = [];
        for (var i = 0; i < obj.data.length; i += 1) {
          x.push(i);
          values.push(obj.data[i].y);
        }
        var layout = {
          xaxis: {autorange: true},
          yaxis: {range: [30, 100]}
        };
        Plotly.newPlot(cpu_rt, [{'x': x, 'y': values, 'type': 'bar'}], layout);
      }
      var url = "http://192.168.178.37:8004/current_cpu_temperature";
      req.open("GET", url, true);
      req.send();

    }

    function update_disks() {
      var req = createRequest(); // defined above
      var disk;
      var id = '';

      // Create the callback:
      req.onreadystatechange = function() {
      if (req.readyState != 4) return; // Not there yet
        // Request successful, read the response
        var obj = JSON.parse(req.responseText)
        var layout = {
          height: 400,
          width: 500
        };
        for (var key in obj) {
          if (obj.hasOwnProperty(key)) {
            id = 'disk__' + key.replace(/\//g, '_');
            id = id.replace(/__/g, '_');
            disk = document.getElementById(id);
            if (disk === null) {
              disks = document.getElementById('disks');
              disk = document.createElement('div');
              disk.setAttribute("id", id)
              disks.appendChild(disk);
            }
            var data = [{values: obj[key], labels: ['Total', 'Free'], type: 'pie'}];
            Plotly.newPlot(disk, data, layout);
          }
        }

      }
      var url = "http://192.168.178.37:8004/disk_usage";
      req.open("GET", url, true);
      req.send();

    }
    update_cpu();

    var t = setInterval(update_cpu, 5000);
    var tt = setInterval(realtime_cpu, 1000);
    var ttt = setInterval(update_disks, 1000);
    </script>
  </head>
  
  <body>
    <div id="cpu_avg"></div>
    <div id="cpus"></div>
    <div id="cpu_realtime"></div>
    <div id="disks"</div>
  </body>
</html>

